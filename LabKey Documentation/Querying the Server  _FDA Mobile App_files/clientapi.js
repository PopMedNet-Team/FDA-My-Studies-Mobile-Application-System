LABKEY.Utils=new function(b,d){var a=function(f,g){var h=LABKEY.Utils.generateUUID();var e='<form method="POST" id="'+h+'" action="'+f+'"><input type="hidden" name="json" value="'+LABKEY.Utils.encodeHtml(LABKEY.Utils.encode(g))+'" /></form>';d("body").append(e);d("#"+h).submit()};var c=function(g,f){var e=d("#lk-utils-modal");if(e.length===0){d("body").append(['<div id="lk-utils-modal" class="modal fade" role="dialog">','<div class="modal-dialog"><div class="modal-content"></div></div>',"</div>"].join(""));e=d("#lk-utils-modal")}e.find(".modal-content").html(['<div class="modal-header">','<button type="button" class="close" data-dismiss="modal">&times;</button>','<h4 class="modal-title">'+LABKEY.Utils.encodeHtml(g)+"</h4>","</div>",'<div class="modal-body">',"<br>","<p>"+LABKEY.Utils.encodeHtml(f)+"</p>","<br>","</div>"].join(""));e.modal("show")};b.displayAjaxErrorResponse=function(e,i,h,g){if(e.status==0){return}var f=LABKEY.Utils.getMsgFromError(e,i,{msgPrefix:g,showExceptionClass:h});LABKEY.Utils.alert("Error",f)};b.convertToExcel=function(e){a(LABKEY.ActionURL.buildURL("experiment","convertArraysToExcel"),e)};b.convertToTable=function(e){a(LABKEY.ActionURL.buildURL("experiment","convertArraysToTable"),e)};b.alert=function(f,e){if(window.Ext4){Ext4.Msg.alert(f?Ext4.htmlEncode(f):"",e?Ext4.htmlEncode(e):"")}else{if(window.Ext){Ext.Msg.alert(f?Ext.util.Format.htmlEncode(f):"",e?Ext.util.Format.htmlEncode(e):"")}else{if(LABKEY.experimental&&LABKEY.experimental.useExperimentalCoreUI===true){c(f,e)}else{alert(LABKEY.Utils.encodeHtml(f+" : "+e))}}}};b.onError=function(e){if(!e){return}console.log("ERROR: "+e.exception);console.log(e);if(!e.noAuditLog){LABKEY.Query.insertRows({containerPath:e.containerPath||"/shared",schemaName:"auditlog",queryName:"Client API Actions",rows:[{EventType:"Client API Actions",Key1:"Client Error",Key2:window.location.href,Key3:(e.stackTrace&&LABKEY.Utils.isArray(e.stackTrace)?e.stackTrace.join("\n"):null),Comment:(e.exception||e.statusText||e.message),Date:new Date()}],success:function(){},failure:function(f){console.log("Problem logging error");console.log(f)}})}};b.setWebpartTitle=function(e,f){d("#webpart_"+f+" span.labkey-wp-title-text").html(LABKEY.Utils.encodeHtml(e))};b.onReady=function(f){var g;var h;var e;if(LABKEY.Utils.isFunction(f)){g=this;h=f;e=null}else{if(LABKEY.Utils.isObject(f)&&LABKEY.Utils.isFunction(f.callback)){g=f.scope||this;h=f.callback;e=f.scripts}else{LABKEY.Utils.alert("Configuration Error","Improper configuration for LABKEY.onReady()");return}}if(e){LABKEY.requiresScript(e,h,g,true)}else{d(function(){h.call(g)})}};b.addClass=function(f,e){if(LABKEY.Utils.isDefined(f)){if(LABKEY.Utils.isDefined(f.classList)){f.classList.add(e)}else{f.className+=" "+e}}};b.removeClass=function(f,e){if(LABKEY.Utils.isDefined(f)){if(LABKEY.Utils.isDefined(f.classList)){f.classList.remove(e)}else{var g=new RegExp("(?:^|\\s)"+e+"(?!\\S)/g");f.className.replace(g,"")}}};b.replaceClass=function(g,e,f){LABKEY.Utils.removeClass(g,e);LABKEY.Utils.addClass(g,f)};b.loadAjaxContent=function(f,m,l,j,e){var h=LABKEY.Utils.decode(f.responseText);if(!h){return}if(h.moduleContext){LABKEY.applyModuleContext(h.moduleContext)}if(h.requiredCssScripts){LABKEY.requiresCss(h.requiredCssScripts)}if(h.implicitCssIncludes){for(var g=0;g<h.implicitCssIncludes.length;g++){LABKEY.requestedCssFiles(h.implicitCssIncludes[g])}}if(h.requiredJsScripts&&h.requiredJsScripts.length){LABKEY.requiresScript(h.requiredJsScripts,k,this,true)}else{k()}function k(){if(h.html){if(LABKEY.Utils.isString(m)){m=d("#"+m)}if(e===true){m.replaceWith(h.html)}else{m.html(h.html)}if(LABKEY.Utils.isFunction(l)){l.call(j||window)}if(h.implicitJsIncludes){LABKEY.loadedScripts(h.implicitJsIncludes)}}}};b.tabInputHandler=function(e){d(e).keydown(function(j){if(j.keyCode==9){var h="\t";var g=this.selectionStart;var f=this.selectionEnd;var i=this.scrollTop;this.value=this.value.substring(0,g)+h+this.value.substring(f,this.value.length);this.focus();this.selectionStart=g+h.length;this.selectionEnd=g+h.length;this.scrollTop=i;j.preventDefault()}})};b.signalWebDriverTest=function(f,j){var h="testSignals";var e="#"+h;var i=d(e);var g='<div id="'+h+'"/>';if(!i.length){d("body").append(g);i=d(e);i.hide()}i.find("div[name="+LABKEY.Utils.encode(f)+"]").remove();i.append('<div name="'+LABKEY.Utils.encodeHtml(f)+'" id="'+LABKEY.Utils.id()+'"/>');if(j){i.find('div[name="'+LABKEY.Utils.encodeHtml(f)+'"]').attr("value",LABKEY.Utils.encodeHtml(j))}};return b}(LABKEY.Utils,jQuery);(function($){if(!LABKEY.help){LABKEY.help={}}LABKEY.help.Tour=new function(){var _hopscotchSessionProperty="hopscotch.tour.state",_localStorageProperty="LABKEY.tours.state",_tours={},_continue={},_queue=[],_next=0,loads=0,me=this,_modeOff="off",_modeRunOnce="runOnce",_modeRunAlways="runAlways",modes=[_modeOff,_modeRunOnce,_modeRunAlways];var _autoRun=function(){if(_next<_queue.length){_display(_tours[_queue[_next]],0);_next++}};var _autoShowFromDb=function(id,step){if(LABKEY.tours[id].mode!=undefined){var modeIndex=parseInt(LABKEY.tours[id].mode);if(modeIndex>modes.length){console.warn("Invalid mode value. TourId: "+id+", Mode: "+modeIndex);return false}if(modes[modeIndex]==_modeOff&&step<1){return false}if(modes[modeIndex]==_modeRunOnce&&seen(id)&&step<1){return false}_load(id,step);return true}console.warn("Tour mode not found. TourId: "+id)};var _display=function(config,step){_initHopscotch(function(){hopscotch.listen("end",function(){setTimeout(_autoRun,1)});if(LABKEY.Utils.isString(step)){step=parseInt(step)}hopscotch.startTour(config,step||0);markSeen(config.id)},me)};var _get=function(idOrConfig){var config=idOrConfig;if(LABKEY.Utils.isString(idOrConfig)){config=_tours[idOrConfig]}if(!config||!config.id){console.warn("tour not found, or not configured properly: "+idOrConfig);return null}return config};var _getContinue=function(){var config={};var hash=window.location.hash,prefix="tourstate:";if(hash&&hash.charAt(0)=="#"){hash=hash.substring(1)}if(hash.substring(0,prefix.length)!=prefix){return config}var tourstate=hash.substring(prefix.length),endIdx=tourstate.indexOf(":");if(-1!=endIdx){config.id=tourstate.substring(0,endIdx);config.step=tourstate.substring(endIdx+1)}return config};var _init=function(){var config=_getContinue();if(LABKEY.tours){$.each(LABKEY.tours,function(tourId,tour){if(!$.isEmptyObject(config)&&config.id==tourId){_autoShowFromDb(tourId,config.step)}else{_autoShowFromDb(tourId,0)}})}};var _initHopscotch=function(fn,scope){var script="/hopscotch/js/hopscotch"+(LABKEY.devMode?"":".min")+".js";var style="/hopscotch/css/hopscotch"+(LABKEY.devMode?"":".min")+".css";LABKEY.requiresScript(script,fn,scope);LABKEY.requiresCss(style)};var _kickoffTours=function(){if(!$.isEmptyObject(_continue)){resume(_continue.id,_continue.step)}_queue=[];_next=0;$.each(_tours,function(key,tour){if(key!=_continue.id){_queue.push(key)}});if($.isEmptyObject(_continue)){_autoRun()}_continue={}};var _load=function(id,step){loads++;LABKEY.Ajax.request({url:LABKEY.ActionURL.buildURL("tours","getTour"),jsonData:{id:id},success:LABKEY.Utils.getCallbackWrapper(function(result){loads--;_parseAndRegister.call(this,id,step,result);if(loads==0){_kickoffTours()}},me,false),failure:LABKEY.Utils.getCallbackWrapper(function(result){loads--},me,false),scope:this})};var _parseAndRegister=function(id,step,result){var tour=JSON.parse(result.json);tour.id=id;var realSteps=[];$.each(tour.steps,function(i,step){var real=eval(JSON.parse(step.step));real.target=step.target;if(!real.placement){real.placement="bottom"}realSteps.push(real)});if(window._stepcontent){delete window._stepcontent}tour.steps=realSteps;_register(tour,step)};var _register=function(config,step){if(!config.id){throw"'id' is required to define a tour."}if(!config.steps||!LABKEY.Utils.isArray(config.steps)){throw"'steps' is required to be an Array to define a tour."}if(config.steps.length>0){if(step>0){_continue.id=config.id;_continue.step=step}if(!_tours.hasOwnProperty(config.id)){_tours[config.id]=config}}};var autoShow=function(id){if(seen(id)){return false}show(id,0);return true};var continueAtLocation=function(href){var context=LABKEY.contextPath;if(href.charAt(0)!="/"){href="/"+href}href=context+href;if(!hopscotch.getCurrTour()){window.location=href}var hopscotchState=hopscotch.getCurrTour().id+":"+hopscotch.getCurrStepNum();var a=document.createElement("A");a.href=href;a.hash="tourstate:"+hopscotchState;window.location=a.href};var continueTour=function(){var config=_getContinue();if(!$.isEmptyObject(config)){return resume(config.id,parseInt(config.step))}};var markSeen=function(id){var state={};var v=localStorage.getItem(_localStorageProperty);if(v){state=LABKEY.Utils.decode(v)}state[id]="seen";localStorage.setItem(_localStorageProperty,LABKEY.Utils.encode(state))};var register=function(config){_register(config,0)};var reset=function(){localStorage.setItem(_localStorageProperty,"{}");_initHopscotch(function(){hopscotch.endTour(true,false)})};var resetRegistration=function(){_tours={}};var resume=function(id,step){var config=_get(id);if(config){var testState=config.id+":"+step;if(testState==sessionStorage.getItem(_hopscotchSessionProperty)){_display(config,step)}return id}};var seen=function(id){var state={};var v=localStorage.getItem(_localStorageProperty);if(v){state=LABKEY.Utils.decode(v)}return"seen"==state[id]};var show=function(id,step){var tour=_get(id);if(tour){_display(tour,step)}};var showFromDb=function(id,step){_load(id,step)};LABKEY.Utils.onReady(_init);return{autoShow:autoShow,continueAtLocation:continueAtLocation,continueTour:continueTour,markSeen:markSeen,register:register,reset:reset,resume:resume,seen:seen,show:show,showFromDb:showFromDb}}})(jQuery);(function(a){LABKEY.Chart=function(f){this.config=f||{};var c=f.renderTo;var e=f.renderImageMapTo;var d=f.containerPath;var b=function(g){var h=LABKEY.Utils.decode(g.responseText);if(e&&h.imageMap){a("#"+c).append('<img src="'+h.imageURL+'" usemap="'+e+'"/>');a("#"+e).append(h.imageMap)}else{a("#"+c).append('<img src="'+h.imageURL+'"/>')}};return{render:function(){if(!f.schemaName||!f.queryName){console.error("Configuration Error: config.schemaName and config.queryName are required parameters");return}if(!c){f.error("Configuration Error: config.renderTo is a required parameter.");return}if(e){f.imageMapName=e}LABKEY.Ajax.request({url:LABKEY.ActionURL.buildURL("reports","plotChartApi",d),success:b,failure:LABKEY.Utils.getOnFailure(f)||LABKEY.Utils.displayAjaxErrorResponse,params:f})}}};LABKEY.Chart.XY="1";LABKEY.Chart.TIME="2"})(jQuery);(function(b){var a=function(){this._isDirty=true};LABKEY.Form=function(c){if(!c||!c.formElement){throw"Invalid config passed to LABKEY.Form constructor! Your config object should have a property named formElement which is the id of your form."}var e=this;var d=b("#"+c.formElement);this.warningMessage=c.warningMessage||"Your changes have not yet been saved.";this._isDirty=false;d.find(":input").change(function(){a.call(e)});d.submit(function(){e.setClean()});if(c.showWarningMessage!==false){b(window).bind("beforeunload",function(f){if(e.isDirty()){f.returnMessage=e.warningMessage;return e.warningMessage}})}};LABKEY.Form.prototype.isDirty=function(){return this._isDirty};LABKEY.Form.prototype.setClean=function(){this._isDirty=false};LABKEY.Form.prototype.setDirty=function(){this._isDirty=true}})(jQuery);LABKEY.NavTrail=new function(){return{setTrail:function(n,o,g,h){var c;if(LABKEY.experimental.useExperimentalCoreUI){c=document.querySelector(".lk-body-title");if(c){var d="";var b="<h3>"+(h!==false?LABKEY.Utils.encodeHtml(n):n)+"</h3>";var l=c.querySelector(".breadcrumb");if(l&&o){d='<ol class="breadcrumb">';for(var e=0;e<o.length;e++){var j=o[e];if(j.url&&j.title){d+='<li><a href="'+j.url+'">'+LABKEY.Utils.encodeHtml(j.title)+"</a></li>"}else{if(j.title){d+="<li><span>"+LABKEY.Utils.encodeHtml(j.title)+"</span></li>"}}}d+="</ol>"}c.innerHTML=d+b}}else{c=document.getElementById("labkey-nav-trail-current-page");if(c){c.innerHTML=n;c.style.visibility="visible"}c=document.getElementById("navTrailAncestors");if(c&&o){var f="",m="";for(var k=0;k<o.length;++k){f+=m;if(o[k].url&&o[k].title){f+="<a href='"+o[k].url+"'>"+o[k].title+"</a>"}else{if(o[k].title){f+=o[k].title}}m=" &gt; "}c.innerHTML=f;c.visibility="visible"}}document.title=(g||n)+": "+decodeURI(LABKEY.ActionURL.getContainer())}}};(function(a){LABKEY.Portal=new function(){var p="move";var d="remove";var f="toggle_frame";var r=0;var e=1;var m=0;var k=1;function l(u,s,v,t){return function(y,w,x){c(y,s,v,t);if(u){u(y,w,x)}}}function c(D,w,v,C){var A=document.getElementById("webpart_"+v);if(A){if(w===p){var s;s=C===r?b(A).above:b(A).below;if(s){var y=A.parentNode;var u=s.nextSibling;var G=A.nextSibling;for(var t=0;t<y.childNodes.length;t++){if(y.childNodes[t]===s){y.removeChild(A);y.removeChild(s);y.insertBefore(A,u);y.insertBefore(s,G);break}}if(LABKEY.experimental.useExperimentalCoreUI){var z=h(A).upButton.className;var x=h(A).downButton.className;o(A,h(s).upButton.className,h(s).downButton.className);o(s,z,x)}}}else{if(w===d){var F=b(A);if(!LABKEY.experimental.useExperimentalCoreUI){var B=A.previousElementSibling;var E=A.previousSibling;A.parentNode.removeChild(B||E)}if(LABKEY.experimental.useExperimentalCoreUI){if(F.below){o(F.below,h(A).upButton.className,undefined)}if(F.above){o(F.above,undefined,h(A).downButton.className)}}A.parentNode.removeChild(A)}}}}function b(t){var s;var u;if(LABKEY.experimental.useExperimentalCoreUI){s=t.previousElementSibling;u=t.nextElementSibling}else{s=t.previousElementSibling.previousElementSibling;u=t.nextElementSibling.nextElementSibling}return{above:s&&s.getAttribute("name")==="webpart"?s:undefined,below:u&&u.getAttribute("name")==="webpart"?u:undefined}}function h(t){var w="fa fa-caret-square-o-up labkey-fa-portal-nav";var x="fa fa-caret-square-o-up labkey-btn-default-toolbar-small-disabled labkey-fa-portal-nav";var v="fa fa-caret-square-o-down labkey-fa-portal-nav";var u="fa fa-caret-square-o-down labkey-btn-default-toolbar-small-disabled labkey-fa-portal-nav";var s=function(A,B){if(A){var z=A.getElementsByClassName("labkey-fa-portal-nav");for(var y=0;y<z.length;y++){if(z[y].className.indexOf(B)>=0){return z[y]}}}};return{upButton:s(t,w)||s(t,x),downButton:s(t,v)||s(t,u)}}function o(s,t,u){if(t){h(s).upButton.className=t}if(u){h(s).downButton.className=u}}function n(s){return function(v,t,u){return s(v,t,u)}}function q(u,s,t){LABKEY.Utils.displayAjaxErrorResponse(s,u)}function g(u,v,w){var x={};LABKEY.Utils.applyTranslated(x,u,{success:false,failure:false,scope:false});if(w==r||w==e){x.direction=w}var t=LABKEY.Utils.getOnFailure(u)||q;if(u.updateDOM){t=n(t)}t=LABKEY.Utils.getCallbackWrapper(t,u.scope,true);var s=u.success;if(u.updateDOM){s=l(LABKEY.Utils.getOnSuccess(u),v,u.webPartId,w)}s=LABKEY.Utils.getCallbackWrapper(s,u.scope);return{params:x,success:s,error:t}}var j=function(u,t,s){LABKEY.requiresExt4Sandbox(function(){Ext4.onReady(function(){var v=Ext4.create("Ext.form.field.Text",{xtype:"textfield",fieldLabel:"Name",labelWidth:50,width:250,name:"tabName",value:s?s:"",maxLength:64,enforceMaxLength:true,enableKeyEvents:true,labelSeparator:"",selectOnFocus:true,listeners:{scope:this,keypress:function(y,x){if(x.getKey()==x.ENTER){t(v.getValue(),w)}}}});var w=Ext4.create("Ext.window.Window",{title:u,closeAction:"destroy",modal:true,border:false,items:[{xtype:"panel",border:false,frame:false,bodyPadding:5,items:[v]}],buttons:[{text:"Ok",scope:this,handler:function(){t(v.getValue(),w)}},{text:"Cancel",scope:this,handler:function(){w.close()}}]});setTimeout(function(){w.show(false,function(){v.focus()},this)},100)})})};var i=function(w,t,u){var v=function(){Ext4.onReady(function(){Ext4.create("LABKEY.Portal.WebPartPermissionsPanel",{webPartId:w,permission:t,containerPath:u,autoShow:true})})};var s=function(){LABKEY.requiresExt4Sandbox(function(){LABKEY.requiresScript("WebPartPermissionsPanel.js",v,this)},this)};if(w){if(LABKEY.Portal.WebPartPermissionsPanel){v()}else{s()}}};return{getWebParts:function(s){LABKEY.Ajax.request({url:LABKEY.ActionURL.buildURL("project","getWebParts.api",s.containerPath),method:"GET",success:LABKEY.Utils.getCallbackWrapper(LABKEY.Utils.getOnSuccess(s),s.scope),failure:LABKEY.Utils.getCallbackWrapper(LABKEY.Utils.getOnFailure(s),s.scope,true),params:s})},moveWebPartUp:function(s){var t=g(s,p,r);LABKEY.Ajax.request({url:LABKEY.ActionURL.buildURL("project","moveWebPartAsync.api",s.containerPath),method:"GET",success:LABKEY.Utils.getOnSuccess(t),failure:LABKEY.Utils.getCallbackWrapper(LABKEY.Utils.getOnFailure(t),t.scope,true),params:t.params})},moveWebPartDown:function(s){var t=g(s,p,e);LABKEY.Ajax.request({url:LABKEY.ActionURL.buildURL("project","moveWebPartAsync.api",s.containerPath),method:"GET",success:LABKEY.Utils.getOnSuccess(t),failure:LABKEY.Utils.getCallbackWrapper(LABKEY.Utils.getOnFailure(t),t.scope,true),params:t.params})},removeWebPart:function(s){var t=g(s,d,undefined);LABKEY.Ajax.request({url:LABKEY.ActionURL.buildURL("project","deleteWebPartAsync.api",s.containerPath),method:"GET",success:LABKEY.Utils.getOnSuccess(t),failure:LABKEY.Utils.getCallbackWrapper(LABKEY.Utils.getOnFailure(t),t.scope,true),params:t.params})},toggleWebPartFrame:function(s){var t=g(s,f,undefined);LABKEY.Ajax.request({url:LABKEY.ActionURL.buildURL("project","toggleWebPartFrameAsync.api",s.containerPath),method:"GET",success:LABKEY.Utils.getOnSuccess(t),failure:LABKEY.Utils.getCallbackWrapper(LABKEY.Utils.getOnFailure(t),t.scope,true),params:t.params})},moveTabLeft:function(s,t){LABKEY.Ajax.request({url:LABKEY.ActionURL.buildURL("admin","moveTab.api",LABKEY.container.path),method:"GET",params:{pageId:s,direction:m},success:LABKEY.Utils.getCallbackWrapper(function(u,v){if(t&&u.pageIdToSwap&&u.pageIdToSwap!==u.pageId){var w=a("#"+t)[0];if(w){a(w.parentElement).insertBefore(w.parentNode.previousElementSibling)}}},this,false),failure:function(u){}})},moveTabRight:function(s,t){LABKEY.Ajax.request({url:LABKEY.ActionURL.buildURL("admin","moveTab.api",LABKEY.container.path),method:"GET",params:{pageId:s,direction:k},success:LABKEY.Utils.getCallbackWrapper(function(u,v){if(t&&u.pageIdToSwap&&u.pageIdToSwap!==u.pageId){var w=a("#"+t)[0];if(w){a(w.parentElement).insertAfter(w.parentNode.nextElementSibling)}}},this,false),failure:function(u,v){}})},toggleTabEditMode:function(){LABKEY.Ajax.request({url:LABKEY.ActionURL.buildURL("admin","toggleTabEditMode.api",LABKEY.container.path),method:"GET",success:LABKEY.Utils.getCallbackWrapper(function(s,u){var t=s.tabEditMode?"tab-edit-mode-disabled":"tab-edit-mode-enabled";var w=s.tabEditMode?"tab-edit-mode-enabled":"tab-edit-mode-disabled";var v=document.getElementsByClassName(t)[0];if(v){if(s.startURL&&v.querySelector("li.tab-nav-active.tab-nav-hidden")){window.location=s.startURL}else{v.setAttribute("class",v.getAttribute("class").replace(t,w))}}})})},addTab:function(){var s=function(t,u){LABKEY.Ajax.request({url:LABKEY.ActionURL.buildURL("admin","addTab.api"),method:"POST",jsonData:{tabName:t},success:function(v){var w=LABKEY.Utils.decode(v.responseText);if(w&&w.success){if(w.url){window.location=w.url}}},failure:function(v){var x=LABKEY.Utils.decode(v.responseText);var w;if(x&&x.errors){w=x.errors[0].message}else{w="An unknown error occurred. Please contact your administrator."}Ext4.Msg.alert(w)}})};if(LABKEY.pageAdminMode){j("Add Tab",s,null)}},showTab:function(s){LABKEY.Ajax.request({url:LABKEY.ActionURL.buildURL("admin","showTab.api"),method:"POST",jsonData:{tabPageId:s},success:function(t){var u=LABKEY.Utils.decode(t.responseText);if(u&&u.success){if(u.url){window.location=u.url}}},failure:function(t){var u=LABKEY.Utils.decode(t.responseText);if(u&&u.errors){alert(u.errors[0].message)}}})},renameTab:function(t,u,s){var v=document.getElementById(u);if(v){var w=function(x,y){LABKEY.Ajax.request({url:LABKEY.ActionURL.buildURL("admin","renameTab.api"),method:"POST",jsonData:{tabPageId:t,tabName:x},success:function(z){var A=LABKEY.Utils.decode(z.responseText);if(A.success){v.textContent=x}y.close()},failure:function(z){var B=LABKEY.Utils.decode(z.responseText);var A;if(B.errors){A=B.errors[0].message}else{A="An unknown error occured. Please contact your administrator."}Ext4.Msg.alert("Oops",A)}})};if(LABKEY.pageAdminMode){j("Rename Tab",w,s)}}},_showPermissions:i}}})(jQuery);LABKEY.Query=new function(b,c){function a(e,h){if(!h["X-LABKEY-CSRF"]){h["X-LABKEY-CSRF"]=LABKEY.CSRF}var i=LABKEY.Utils.generateUUID();var f='<form method="POST" id="'+i+'"action="'+e+'">';for(var d in h){if(!h.hasOwnProperty(d)){continue}var g=h[d];if(g==undefined){continue}f+='<input type="hidden" name="'+LABKEY.Utils.encodeHtml(d)+'" value="'+LABKEY.Utils.encodeHtml(g)+'" />'}f+="</form>";c("body").append(f);c("form#"+i).submit()}b.exportSql=function(e){var d=LABKEY.ActionURL.buildURL("query","exportSql",e.containerPath);var f={sql:e.sql,schemaName:e.schemaName,format:e.format,containerFilter:e.containerFilter};a(d,f)};b.exportTables=function(g){var j={};if(g.headerType){j.headerType=g.headerType}var h=LABKEY.Utils.merge({},g.schemas);for(var m in h){if(!h.hasOwnProperty(m)){continue}var f=h[m];for(var k=0;k<f.length;k++){var l=f[k];var e=LABKEY.Utils.merge({},l);delete e.filter;delete e.filterArray;delete e.sort;e.filters=LABKEY.Filter.appendFilterParams(null,l.filters||l.filterArray);if(l.sort){e.filters["query.sort"]=l.sort}f[k]=e}}j.schemas=JSON.stringify(h);var d=LABKEY.ActionURL.buildURL("query","exportTables.view");a(d,j)};return b}(LABKEY.Query,jQuery);LABKEY.Security=new function(a){a.Impersonation=new function(){var b=function(c){LABKEY.requiresExt4ClientAPI(function(){LABKEY.requiresScript("Impersonate.js",function(){Ext4.onReady(function(){Ext4.create(c).show()})})})};return{showImpersonateUser:function(){b("LABKEY.Security.ImpersonateUser")},showImpersonateGroup:function(){b("LABKEY.Security.ImpersonateGroup")},showImpersonateRole:function(){b("LABKEY.Security.ImpersonateRoles")}}};return a}(LABKEY.Security);LABKEY.Query.GetData=new function(a){a.renderQueryWebPart=function(c){var d=validateGetDataConfig(c);d.renderer.type="json";d.renderer.maxRows=0;if(!c.webPartConfig){throw new Error("A webPartConfig object is required.")}var b={method:"POST",url:LABKEY.ActionURL.buildURL("query","getData",c.source.containerPath),jsonData:d,success:function(e){var f=LABKEY.Utils.decode(e.responseText);c.webPartConfig.schemaName=c.source.schemaName;c.webPartConfig.queryName=f.queryName;new LABKEY.QueryWebPart(c.webPartConfig)},failure:function(e,f){if(e.status!=0){LABKEY.Utils.displayAjaxErrorResponse(e,null,true,"Error during GetData call")}}};LABKEY.Ajax.request(b)};return a}(LABKEY.Query.GetData);(function(a){LABKEY.WebPart=function(f){var m=f.renderTo;var p=f.partName;var j=f.frame;var o=f.bodyClass;var q=f.title;var e=f.titleHref;var b=f.partConfig;var c=LABKEY.Utils.getOnFailure(f);var n=LABKEY.Utils.getOnSuccess(f);var l=f.containerPath;var d=f.scope||this;var i=f.supressRenderErrors;var h=f.partUrl||LABKEY.ActionURL.buildURL("project","getWebPart",l);if(!p){LABKEY.Utils.alert("Configuration Error","You must supply the name of the desired web part in the partName config property.");return}if(!m){LABKEY.Utils.alert("Configuration Error","You must supply the name of the target element in the renderTo config property.");return}var g=function(r){var t="Error getting the web part: ";if(r.status==0){return}if(r.status>=500&&r.status<600){var s=LABKEY.Utils.decode(r.responseText);if(s){t+=s.exception}}else{t+=r.statusText}LABKEY.Utils.alert("Error",t)};var k=function(s,t){if(t.params.beforeRender){var u=t.params.beforeRender.call(d,s);if(u===false){return}else{if(u){s=u}}}if(m){var v=a("#"+m);if(v.length>0){LABKEY.Utils.loadAjaxContent(s,v,n,d)}else{if(!i){LABKEY.Utils.alert("Rendering Error","The element '"+m+"' does not exist in the document!")}}}else{if(!i){LABKEY.Utils.alert("Rendering Error","The target element name was not set!")}}};return{render:function(){if(!b){b={}}b["webpart.name"]=p;if(j){b["webpart.frame"]=j}if(o){b["webpart.bodyClass"]=o}if(q){b["webpart.title"]=q}if(e){b["webpart.titleHref"]=e}if(b.returnURL){b.returnURL=encodeURI(b.returnURL)}if(!c){c=g}var r=a.extend(true,{},LABKEY.ActionURL.getParameters(),b);delete r._dc;return LABKEY.Ajax.request({url:h,success:k,failure:c,method:"GET",params:r})}}};LABKEY.WebPart.createReportWebpart=function(b){var c=a.extend({},b.webPartConfig);c.partName="Report";a.each(["renderTo","success","failure"],function(d,e){if(LABKEY.Utils.isDefined(b[e])){c[e]=b[e]}});c.partConfig=a.extend({},b.reportProperties);a.each(["reportId","reportName","schemaName","queryName","title"],function(d,e){if(LABKEY.Utils.isDefined(b[e])){c.partConfig[e]=b[e]}});return new LABKEY.WebPart(c)}})(jQuery);if(!LABKEY.DataRegions){LABKEY.DataRegions={}}(function(am){var aC=".~";var aG=".columns";var M=30000;var at=".param.";var an=".reportId";var Y=".sort",r="+",g="-";var av=".offset";var aD=".maxRows",ai=".showRows";var aE=".containerFilterName";var l="~~customizeView~~";var p=".viewName";var L=["afterpanelhide","afterpanelshow","beforechangeview","beforeclearsort","beforemaxrowschange","beforeoffsetchange","beforerefresh","beforesetparameters","beforesortchange","render","selectchange","success"];var E={"~":true,columns:true,param:true,reportId:true,sort:true,offset:true,maxRows:true,showRows:true,containerFilterName:true,viewName:true,disableAnalytics:true};var P={};LABKEY.DataRegion=function(aI){ae.call(this,aI,true)};LABKEY.DataRegion.prototype.toJSON=function(){return{name:this.name,schemaName:this.schemaName,queryName:this.queryName,viewName:this.viewName,offset:this.offset,maxRows:this.maxRows,messages:this.msgbox.toJSON()}};var ae=function(aI,aL){if(!aI.dataRegionName){if(!aI.name){this.name=LABKEY.Utils.id("aqwp")}else{this.name=aI.name}}else{if(!aI.name){this.name=aI.dataRegionName}else{this.name=aI.name}}if(!this.name){throw'"name" is required to initialize a LABKEY.DataRegion'}var aO=aI._useQWPDefaults===true;delete aI._useQWPDefaults;var aJ;if(aL){delete aI._userSort;var aK={_allowHeaderLock:aO,_failure:aO?LABKEY.Utils.getOnFailure(aI):undefined,_success:aO?LABKEY.Utils.getOnSuccess(aI):undefined,aggregates:undefined,allowChooseQuery:undefined,allowChooseView:undefined,async:aO,bodyClass:undefined,buttonBar:undefined,buttonBarPosition:undefined,chartWizardURL:undefined,complete:false,containerFilter:undefined,containerPath:undefined,dataRegionName:this.name,detailsURL:undefined,domId:undefined,facetLoaded:false,filters:undefined,frame:aO?undefined:"none",errorType:"html",id:this.name,deleteURL:undefined,importURL:undefined,insertURL:undefined,linkTarget:undefined,maxRows:0,metadata:undefined,name:this.name,offset:0,parameters:undefined,queryName:"",disableAnalytics:false,removeableContainerFilter:undefined,removeableFilters:undefined,removeableSort:undefined,renderTo:undefined,reportId:undefined,requestURL:aO?window.location.href:(document.location.search.substring(1)||""),returnURL:aO?window.location.href:undefined,schemaName:"",scope:this,selectAllURL:undefined,selectedCount:0,shadeAlternatingRows:undefined,showBorders:undefined,showDeleteButton:undefined,showDetailsColumn:undefined,showExportButtons:undefined,showImportDataButton:undefined,showInsertNewButton:undefined,showPagination:undefined,showPaginationCount:undefined,showRecordSelectors:false,showReports:undefined,showRows:"paginated",showSurroundingBorder:undefined,showUpdateColumn:undefined,showViewPanel:undefined,sort:undefined,sql:undefined,suppressRenderErrors:false,timeout:undefined,title:undefined,titleHref:undefined,totalRows:undefined,updateURL:undefined,userContainerFilter:undefined,userFilters:{},viewName:null};aJ=am.extend({},aK,aI)}else{aJ=am.extend({},aI)}if(!am.isArray(aJ.filters)&&am.isArray(aI.filterArray)){aJ.filters=aI.filterArray}var aM={failure:true,success:true};for(var aQ in aJ){if(aJ.hasOwnProperty(aQ)&&!aM[aQ]){this[aQ]=aJ[aQ]}}if(aI.renderTo){ac(this,aI.renderTo)}if(am.isArray(this.removeableFilters)){LABKEY.Filter.appendFilterParams(this.userFilters,this.removeableFilters,this.name);delete this.removeableFilters}if(this._userSort===undefined){this._userSort=o(this,true)}if(LABKEY.Utils.isString(this.removeableSort)){this._userSort=this.removeableSort+(this._userSort?this._userSort:"");delete this.removeableSort}this._allowHeaderLock=this.allowHeaderLock===true;if(!aI.messages){this.messages={}}this.selectionModified=false;this.panelConfigurations={};if(aO&&this.renderTo){n(this)}else{if(!aO){aF.call(this);f.call(this);af.call(this);al.call(this);j.call(this);U.call(this);k.call(this)}}if(aO){var aN=this;if(aI.listeners){var aP=aI.listeners.scope||aN;am.each(aI.listeners,function(aS,aR){if(am.inArray(aS,L)>-1){var aT;if(am.isFunction(aR)){aT=aR}else{if(am.isFunction(aR.fn)){aT=aR.fn}else{throw"Unsupported listener configuration: "+aS}}am(aN).bind(aS,function(){aT.apply(aP,am(arguments).slice(1))})}else{if(aS!="scope"){throw"Unsupported listener: "+aS}}})}}};LABKEY.DataRegion.prototype.destroy=function(){this.disableHeaderLock()};LABKEY.DataRegion.prototype.refresh=function(){am(this).trigger("beforerefresh",this);if(this.async){n(this)}else{window.location.reload()}};LABKEY.DataRegion.prototype.addFilter=function(aI){w(this,aI)};LABKEY.DataRegion.prototype.clearAllFilters=function(){if(this.async){this.offset=0;this.userFilters={}}aq(this,[aC,av])};LABKEY.DataRegion.prototype.clearFilter=function(aI){var aL=Q(this,aI);if(aL){var aJ="."+aL.toString()+"~";if(this.async){this.offset=0;if(this.userFilters){var aM=this.name+aJ,aK=this;am.each(this.userFilters,function(aO,aN){if(aO.indexOf(aM)>=0){delete aK.userFilters[aO]}})}}aq(this,[aJ,av])}};LABKEY.DataRegion.prototype.getContainerFilter=function(){var aI;if(LABKEY.Utils.isString(this.containerFilter)&&this.containerFilter.length>0){aI=this.containerFilter}else{if(LABKEY.Utils.isObject(this.view)&&LABKEY.Utils.isString(this.view.containerFilter)&&this.view.containerFilter.length>0){aI=this.view.containerFilter}}return aI};LABKEY.DataRegion.prototype.getDataRegion=function(){return this};LABKEY.DataRegion.prototype.getUserContainerFilter=function(){return this.getParameter(this.name+aE)};LABKEY.DataRegion.prototype.getUserFilter=function(){if(LABKEY.devMode){console.warn(["LABKEY.DataRegion.getUserFilter() is deprecated since release 12.2.","Consider using getUserFilterArray() instead."].join(" "))}var aI=[];am.each(this.getUserFilterArray(),function(aJ,aK){aI.push({fieldKey:aK.getColumnName(),op:aK.getFilterType().getURLSuffix(),value:aK.getValue()})});return aI};LABKEY.DataRegion.prototype.getUserFilterArray=function(){var aK=[],aI=this;var aJ=m(this);am.each(aJ,function(aN,aO){if(aO[0].indexOf(aI.name+".")==0&&aO[0].indexOf("~")>-1){var aM=aO[0].indexOf("~");var aL=aO[0].substring(aI.name.length+1,aM);var aP=aO[0].substring(aM+1);aK.push(LABKEY.Filter.create(aL,aO[1],LABKEY.Filter.getFilterTypeForURLSuffix(aP)))}});return aK};LABKEY.DataRegion.prototype.removeFilter=function(aI){if(LABKEY.Utils.isObject(aI)&&LABKEY.Utils.isFunction(aI.getColumnName)){w(this,null,[this.name+"."+aI.getColumnName()+"~"])}};LABKEY.DataRegion.prototype.replaceFilter=function(aI,aK){var aJ=aK?aK:aI;w(this,aI,[this.name+"."+aJ.getColumnName()+"~"])};LABKEY.DataRegion.prototype.replaceFilters=function(aM,aN){var aL=[],aJ=[],aK=this;if(am.isArray(aM)){am.each(aM,function(aO,aP){aL.push(aK.name+"."+aP.getColumnName()+"~");aJ.push([aP.getURLParameterName(aK.name),aP.getURLParameterValue()])})}var aI=[];if(am.isArray(aN)){aI=aI.concat(aN)}else{if(am.isPlainObject(aN)&&aN.fieldKey){aI.push(aN.fieldKey.toString())}}if(aI.length>0){am.each(m(this),function(aO,aQ){var aP=aQ[0];if(aP.indexOf(aK.name+".")===0&&aP.indexOf("~")>-1){am.each(aI,function(aS,aR){var aT=aR&&aR.length&&aR[aR.length-1]=="/"?"":"~";if(aP.indexOf(aK.name+"."+aR+aT)>-1){aL.push(aP)}})}})}c(this,aJ,[av].concat(am.unique(aL)))};LABKEY.DataRegion.prototype.replaceFilterMatch=function(aJ,aL){var aI=[],aK=this;am.each(m(this),function(aM,aN){if(aN[0].indexOf(aK.name+".")==0&&aN[0].indexOf(aL)>-1){aI.push(aN[0])}});w(this,aJ,aI)};var af=function(){var aJ=this,aI=ag(this);if(aI&&aI.length){this.form=aI[0]}if(aI&&this.showRecordSelectors){ab(this)}S(this).on("click",function(aL){aL.stopPropagation();aJ.selectPage.call(aJ,this.checked)});V(this).on("click",function(){aJ.selectRow.call(aJ,this)});var aK=aI.find(".labkey-data-region > tbody > tr");aK.on("click",function(aL){if(aL.target&&aL.target.tagName.toLowerCase()==="td"){am(this).siblings("tr").removeClass("lk-row-hl");am(this).addClass("lk-row-hl")}});aK.on("mouseenter",function(){am(this).siblings("tr").removeClass("lk-row-over");am(this).addClass("lk-row-over")});aK.on("mouseleave",function(){am(this).removeClass("lk-row-over")})};LABKEY.DataRegion.prototype.clearSelected=function(aI){aI=aI||{};aI.selectionKey=this.selectionKey;aI.scope=aI.scope||this;this.selectedCount=0;ab(this);if(aI.selectionKey){LABKEY.DataRegion.clearSelected(aI)}if(this.showRows=="selected"){aq(this,[ai])}else{if(this.showRows=="unselected"){window.location.reload(true)}else{s(this,false);this.removeMessage("selection")}}};LABKEY.DataRegion.prototype.getChecked=function(){var aI=[];V(this).each(function(){if(this.checked){aI.push(this.value)}});return aI};LABKEY.DataRegion.prototype.getSelected=function(aI){if(!this.selectionKey){return}aI=aI||{};aI.selectionKey=this.selectionKey;LABKEY.DataRegion.getSelected(aI)};LABKEY.DataRegion.prototype.getSelectionCount=function(){if(!am("#"+this.domId)){return 0}var aI=0;V(this).each(function(){if(this.checked===true){aI++}});return aI};LABKEY.DataRegion.prototype.hasSelected=function(){return this.getSelectionCount()>0};LABKEY.DataRegion.prototype.isPageSelected=function(){var aJ=V(this);var aI=0;for(;aI<aJ.length;aI++){if(!aJ[aI].checked){return false}}return aI>0};LABKEY.DataRegion.prototype.selectAll=function(aI){if(this.selectionKey){aI=aI||{};aI.scope=aI.scope||this;if(this.selectAllURL){aI.url=this.selectAllURL}else{aI=LABKEY.Utils.apply(aI,this.getQueryConfig())}aI=ax(this,aI);LABKEY.DataRegion.selectAll(aI);if(this.showRows==="selected"){window.location.reload(true)}else{if(this.showRows==="unselected"){aq(this,[ai])}else{s(this,true)}}}};LABKEY.DataRegion.prototype.selectNone=LABKEY.DataRegion.prototype.clearSelected;LABKEY.DataRegion.prototype.selectPage=function(aK){var aL=(aK===true);var aI=s(this,aL);var aJ=this;if(aI.length>0){S(this).each(function(){this.checked=aL});this.setSelected({ids:aI,checked:aL,success:function(aN){if(aN&&aN.count>0&&!this.complete){var aM=aN.count;var aO;if(aJ.totalRows){if(aM==aJ.totalRows){aO='All <span class="labkey-strong">'+this.totalRows+"</span> rows selected."}else{aO='Selected <span class="labkey-strong">'+aM+"</span> of "+this.totalRows+" rows."}}else{aO='Selected <span class="labkey-strong">'+aM+"</span> rows."}b(aJ,aO)}else{this.removeMessage("selection")}}})}return aI};LABKEY.DataRegion.prototype.selectRow=function(aI){this.setSelected({ids:[aI.value],checked:aI.checked});if(!aI.checked){this.removeMessage("selection")}};LABKEY.DataRegion.prototype.setSelected=function(aJ){if(!aJ||!LABKEY.Utils.isArray(aJ.ids)||aJ.ids.length==0){return}var aK=this;aJ=aJ||{};aJ.selectionKey=this.selectionKey;aJ.scope=aJ.scope||aK;aJ=ax(this,aJ);var aI=LABKEY.Utils.getOnFailure(aJ);if(am.isFunction(aI)){aJ.failure=aI}else{aJ.failure=function(){aK.addMessage("Error sending selection.")}}if(aJ.selectionKey){LABKEY.DataRegion.setSelected(aJ)}else{if(am.isFunction(aJ.success)){aJ.success.call(aJ.scope,{count:this.getSelectionCount()})}}};LABKEY.DataRegion.prototype.clearAllParameters=function(){if(this.async){this.offset=0;this.parameters=undefined}aq(this,[at,av])};LABKEY.DataRegion.prototype.getParameter=function(aI){var aJ=null;am.each(m(this),function(aK,aL){if(aL.length>0&&aL[0]==aI){aJ=aL.length>1?aL[1]:"";return false}});return aJ};LABKEY.DataRegion.prototype.getParameters=function(aL){var aK=this.parameters?this.parameters:{},aJ=new RegExp("^"+LABKEY.Utils.escapeRe(this.name)+at.replace(/\./g,"\\."),"i"),aI;am.each(m(this),function(aM,aN){if(aN.length>0&&aN[0].match(aJ)){aI=aN[0].replace(aJ,"");if(aL===true){aI=aI.toLowerCase()}aK[aI]=aN[1]}});return aK};LABKEY.DataRegion.prototype.setParameters=function(aN){var aM=am.Event("beforesetparameters");am(this).trigger(aM);if(aM.isDefaultPrevented()){return}var aL=this.name+at,aK=[];var aJ=this.parameters?this.parameters:{};function aI(aQ,aO){var aP=aQ;if(aQ.indexOf(aL)!==0){aP=aL+aQ}aJ[aP.replace(aL,"")]=aO;aK.push([aP,aO])}if(LABKEY.Utils.isObject(aN)){am.each(aN,aI)}else{if(LABKEY.Utils.isArray(aN)){am.each(aN,function(aO,aP){if(LABKEY.Utils.isArray(aP)&&aP.length>1){aI(aP[0],aP[1])}})}else{return}}this.parameters=aJ;c(this,aK,[at,av])};LABKEY.DataRegion.prototype.getSearchString=function(){if(!LABKEY.Utils.isString(this.savedSearchString)){this.savedSearchString=document.location.search.substring(1)||""}return this.savedSearchString};LABKEY.DataRegion.prototype.setSearchString=function(aJ,aI){this.savedSearchString=aI||"";window.location.assign(window.location.pathname+"?"+this.savedSearchString)};var f=function(){if(!this.msgbox){this.msgbox=new z(this);this.msgbox.on("rendermsg",function(aI,aJ,aK){N(this,aK)},this)}else{this.msgbox.bindRegion(this)}if(this.messages){this.msgbox.setMessages(this.messages);this.msgbox.render()}};LABKEY.DataRegion.prototype.addMessage=function(aJ,aI){this.hidePanel();if(LABKEY.Utils.isString(aJ)){this.msgbox.addMessage(aJ,aI)}else{if(LABKEY.Utils.isObject(aJ)){this.msgbox.addMessage(aJ.html,aJ.part||aI,aJ.append);if(aJ.hideButtonPanel){this.hideButtonPanel()}if(aJ.duration){var aK=this;setTimeout(function(){aK.removeMessage(aJ.part||aI);u(aK).trigger("resize")},aJ.duration)}}}};LABKEY.DataRegion.prototype.clearMessage=function(){if(this.msgbox){this.msgbox.clear()}};LABKEY.DataRegion.prototype.getMessage=function(aI){if(this.msgbox){return this.msgbox.getMessage(aI)}};LABKEY.DataRegion.prototype.hasMessage=function(aI){return this.msgbox&&this.msgbox.hasMessage(aI)};LABKEY.DataRegion.prototype.hideContext=function(){aj(this).hide();A(this).hide()};LABKEY.DataRegion.prototype.hideMessage=function(aI){if(this.msgbox){this.msgbox.hide();if(!aI){this.removeAllMessages()}}};LABKEY.DataRegion.prototype.isMessageShowing=function(){return this.msgbox&&this.msgbox.isVisible()};LABKEY.DataRegion.prototype.removeAllMessages=function(){if(this.msgbox){this.msgbox.removeAll()}};LABKEY.DataRegion.prototype.removeMessage=function(aI){if(this.msgbox){this.msgbox.removeMessage(aI)}};LABKEY.DataRegion.prototype.showLoadingMessage=function(aI){aI=aI||"Loading...";this.addMessage('<div><span class="loading-indicator">&nbsp;</span><em>'+aI+"</em></div>","drloading")};LABKEY.DataRegion.prototype.hideLoadingMessage=function(){this.removeMessage("drloading")};LABKEY.DataRegion.prototype.showSuccessMessage=function(aI){aI=aI||"Completed successfully.";this.addMessage('<div class="labkey-message">'+aI+"</div>")};LABKEY.DataRegion.prototype.showErrorMessage=function(aI){aI=aI||"An error occurred.";this.addMessage('<div class="labkey-error">'+aI+"</div>")};LABKEY.DataRegion.prototype.showContext=function(){aF();var aJ=aj(this);if(aJ.html().trim()!==""){aJ.show()}var aI=A(this);if(aI.html().trim()!==""){aI.show()}};LABKEY.DataRegion.prototype.showMessage=function(aI){if(this.msgbox){this.msgbox.addMessage(aI)}};LABKEY.DataRegion.prototype.showMessageArea=function(){if(this.msgbox&&this.msgbox.hasContent()){this.msgbox.show()}};LABKEY.DataRegion.prototype.displaySection=function(aJ){var aI=aJ&&aJ.dir?aJ.dir:"n";var aK=aA(this,aI);if(aJ&&aJ.html){aJ.append===true?aK.append(aJ.html):aK.html(aJ.html)}aK.show()};LABKEY.DataRegion.prototype.hideSection=function(aJ){var aI=aJ&&aJ.dir?aJ.dir:"n";var aK=aA(this,aI);aK.hide();if(aJ&&aJ.clear===true){aK.html("")}};LABKEY.DataRegion.prototype.writeSection=function(aM,aK){var aI=aK&&aK.append===true;var aJ=aK&&aK.dir?aK.dir:"n";var aL=aA(this,aJ);aI?aL.append(aM):aL.html(aM)};LABKEY.DataRegion.prototype.changeSort=function(aI,aK){if(!aI){return}aI=Q(this,aI);var aJ=aI.toString();var aL=am.Event("beforesortchange");am(this).trigger(aL,[this,aJ,aK]);if(aL.isDefaultPrevented()){return}this._userSort=W(this,this._userSort,aI,aK);d(this,Y,this._userSort,[Y,av])};LABKEY.DataRegion.prototype.clearSort=function(aI){if(!aI){return}aI=Q(this,aI);var aJ=aI.toString();var aK=am.Event("beforeclearsort");am(this).trigger(aK,[this,aJ]);if(aK.isDefaultPrevented()){return}this._userSort=W(this,this._userSort,aI);if(this._userSort.length>0){d(this,Y,this._userSort,[Y,av])}else{aq(this,[Y,av])}};LABKEY.DataRegion.prototype.getUserSort=function(){return o(this)};var j=function(){if(this.showPagination){var aJ=F(this).find(".labkey-pagination");if(aJ&&aJ.length){var aX=am.isNumeric(this.offset);var aO=am.isNumeric(this.totalRows);if(aX){if(aO&&this.totalRows<5){return}var a4=this.offset+1;var aN=this.offset+this.rowCount;if(aO&&(this.rowCount===null||this.rowCount<1)){aN=this.totalRows}var aZ=this.offset&&this.offset>0;var a1=!(a4===1&&aN===this.totalRows)&&(this.offset+this.maxRows<=this.totalRows);var aK=aZ&&LABKEY.Utils.id();var aP=a1&&LABKEY.Utils.id();var aM=a4.toLocaleString()+" - "+aN.toLocaleString();if(aO&&this.showPaginationCount!==false){aM+=" of "+this.totalRows.toLocaleString()}var aU=LABKEY.Utils.id();var a2=['<div id="'+aU+'" class="lk-menu-drop dropdown paging-widget">','<a data-toggle="dropdown" class="unselectable">'+aM+"</a>",'<ul class="dropdown-menu dropdown-menu-left">',(aZ?'<li><a id="'+aK+'" tabindex="0">Show first</a></li>':'<li aria-disabled="true" class="disabled"><a>Show first</a></li>'),(a1?'<li><a id="'+aP+'" tabindex="0">Show last</a></li>':'<li aria-disabled="true" class="disabled"><a>Show last</a></li>'),'<li class="dropdown-submenu"><a class="subexpand subexpand-icon" tabindex="0">Paging<i class="fa fa-chevron-right"></i></a>','<ul class="dropdown-layer-menu">','<li><a class="subcollapse" tabindex="3"><i class="fa fa-chevron-left"></i>Paging</a></li>','<li class="divider"></li>'];var aL=[20,40,100,250];if(this.maxRows>0&&aL.indexOf(this.maxRows)===-1){aL.push(this.maxRows);aL=aL.sort(function(a6,a5){return a6-a5})}var a0={};for(var aY=0;aY<aL.length;aY++){var aS=LABKEY.Utils.id();a0[aS]=aL[aY];if(this.maxRows===aL[aY]){a2.push('<li><a id="'+aS+'" tabindex="0" style="padding-left: 0;"><i class="fa fa-check-square-o"></i>'+aL[aY]+" per page</a></li>")}else{a2.push('<li><a id="'+aS+'" tabindex="0">'+aL[aY]+" per page</a></li>")}}a2.push("</ul></ul></div>");aJ.append(a2.join(""));if(aZ){am("#"+aK).click(T.bind(this,aZ))}if(a1){am("#"+aP).click(I.bind(this,a1))}for(var a3 in a0){if(a0.hasOwnProperty(a3)){am("#"+a3).click(x.bind(this,a0[a3]))}}if(a4===1&&aN===this.totalRows){am("#"+aU).css("top","4px");return}var aW=this.maxRows>0&&aN!==this.totalRows,aV=this.maxRows>0&&a4>1,aI=LABKEY.Utils.id(),aQ=LABKEY.Utils.id();aJ.append(['<div class="btn-group" style="padding-left: 5px;">','<button id="'+aI+'" class="btn btn-default"><i class="fa fa-chevron-left"></i></button>','<button id="'+aQ+'" class="btn btn-default"><i class="fa fa-chevron-right"></i></button>',"</div>"].join(""));var aR=am("#"+aI);aR.click(ad.bind(this,this.offset-this.maxRows,aV));if(!aV){aR.addClass("disabled")}var aT=am("#"+aQ);aT.click(ad.bind(this,this.offset+this.maxRows,aW));if(!aW){aT.addClass("disabled")}}}}else{u(this).find("div.labkey-pagination").css("visibility","visible")}};var ad=function(aJ,aI){if(aI){this.setPageOffset(aJ)}return false};var T=function(aI){if(aI){this.setPageOffset(0)}return false};var I=function(aJ){if(aJ){var aI=this.totalRows%this.maxRows===0?this.maxRows:this.totalRows%this.maxRows;this.setPageOffset(this.totalRows-aI)}return false};var x=function(aI){if(this.maxRows!==aI){this.setMaxRows(aI)}return false};LABKEY.DataRegion.prototype.showAllRows=function(){y(this,"all")};LABKEY.DataRegion.prototype.showAll=LABKEY.DataRegion.prototype.showAllRows;LABKEY.DataRegion.prototype.showSelectedRows=function(){y(this,"selected")};LABKEY.DataRegion.prototype.showSelected=LABKEY.DataRegion.prototype.showSelectedRows;LABKEY.DataRegion.prototype.showUnselectedRows=function(){y(this,"unselected")};LABKEY.DataRegion.prototype.showUnselected=LABKEY.DataRegion.prototype.showUnselectedRows;LABKEY.DataRegion.prototype.showPaged=function(){aq(this,[ai])};LABKEY.DataRegion.prototype.showFirstPage=function(){this.setPageOffset(0)};LABKEY.DataRegion.prototype.pageFirst=LABKEY.DataRegion.prototype.showFirstPage;LABKEY.DataRegion.prototype.setPageOffset=function(aI){var aJ=am.Event("beforeoffsetchange");am(this).trigger(aJ,[this,aI]);if(aJ.isDefaultPrevented()){return}this.showRows=undefined;if(am.isNumeric(aI)){d(this,av,aI,[av,ai])}else{aq(this,[av,ai])}};LABKEY.DataRegion.prototype.setOffset=LABKEY.DataRegion.prototype.setPageOffset;LABKEY.DataRegion.prototype.setMaxRows=function(aJ){var aI=am.Event("beforemaxrowschange");am(this).trigger(aI,[this,aJ]);if(aI.isDefaultPrevented()){return}this.showRows=undefined;this.offset=0;d(this,aD,aJ,[av,aD,ai])};var aF=function(){var aL=aj(this);aL.find(".labkey-button-bar").remove();var aJ=aL.find(".fa-filter").length;var aK=aL.find(".fa-question").length;var aI=[];if(aK>0){aI=aI.concat(['<div class="labkey-button-bar" style="margin-top:10px;float:left;">','<span class="labkey-button ctx-clear-var">Clear Variables</span>',"</div>"])}if(aJ>=2){aI=aI.concat(['<div class="labkey-button-bar" style="margin-top:10px;float:left;">','<span class="labkey-button ctx-clear-all">'+(aK>0?"Clear Filters":"Clear All")+"</span>","</div>"])}if(aI.length){aL.append(aI.join(""));aL.find(".ctx-clear-var").off("click").on("click",am.proxy(this.clearAllParameters,this));aL.find(".ctx-clear-all").off("click").on("click",am.proxy(this.clearAllFilters,this))}};var U=function(){if(this.view&&this.view.session){A(this).find(".labkey-button-bar").remove();A(this).append(['<div class="labkey-button-bar" style="margin-top:10px;float:left;">','<span style="padding:0 10px;">This grid view has been modified.</span>','<span class="labkey-button unsavedview-revert">Revert</span>','<span class="labkey-button unsavedview-edit">Edit</span>','<span class="labkey-button unsavedview-save">Save</span>',"</div>"].join(""));A(this).find(".unsavedview-revert").off("click").on("click",am.proxy(function(){Z(this)},this));A(this).find(".unsavedview-edit").off("click").on("click",am.proxy(function(){this.showCustomizeView(undefined)},this));A(this).find(".unsavedview-save").off("click").on("click",am.proxy(function(){t(this)},this))}};LABKEY.DataRegion.prototype.changeView=function(aJ,aI){var aM=am.Event("beforechangeview");am(this).trigger(aM,[this,aJ,aI]);if(aM.isDefaultPrevented()){return}var aL=[],aK=[],aN=[av,ai,p,an];this.viewName=undefined;this.reportId=undefined;if(aJ){if(LABKEY.Utils.isString(aJ)){aL.push([p,aJ]);this.viewName=aJ}else{if(aJ.type==="report"){aL.push([an,aJ.reportId]);this.reportId=aJ.reportId}else{if(aJ.type==="view"&&aJ.viewName){aL.push([p,aJ.viewName]);this.viewName=aJ.viewName}}}}if(aI){am.each(aI.filter,function(aO,aP){aL.push(["."+aP.fieldKey+"~"+aP.op,aP.value])});if(aI.sort&&aI.sort.length>0){am.each(aI.sort,function(aP,aO){aK.push((aO.dir==="+"?"":aO.dir)+aO.fieldKey)});aL.push([Y,aK.join(",")])}if(aI.containerFilter){aL.push([aE,aI.containerFilter])}aN=aN.concat([aC,Y,aG,aE])}c(this,aL,aN)};LABKEY.DataRegion.prototype.getQueryDetails=function(aO,aJ,aK){var aL=[],aM=this.getUserSort(),aP=this.getParameter(this.name+aG),aI=[],aN=(this.view&&this.view.name)||this.viewName||"";am.each(this.getUserFilterArray(),function(aQ,aR){aL.push({fieldKey:aR.getColumnName(),op:aR.getFilterType().getURLSuffix(),value:aR.getValue()})});am.each(aL,function(aQ,aR){aI.push(aR.fieldKey)});am.each(aM,function(aR,aQ){aI.push(aQ.fieldKey)});LABKEY.Query.getQueryDetails({containerPath:this.containerPath,schemaName:this.schemaName,queryName:this.queryName,viewName:aN,fields:aI,initializeMissingView:true,success:function(aQ){aO.call(aK||this,aQ,aN,aP,aL,aM)},failure:aJ,scope:aK})};LABKEY.DataRegion.prototype.hideCustomizeView=function(){if(this.activePanelId===l){this.hideButtonPanel()}};LABKEY.DataRegion.prototype.showCustomizeView=function(aJ){var aL=this;var aK=this.getPanelConfiguration(l);if(!aK){var aI=setTimeout(function(){aI=0;aL.showLoadingMessage("Opening custom view designer...")},500);LABKEY.DataRegion.loadViewDesigner(function(){var aN=function(aR,aW,aV,aU,aO){aI>0?clearTimeout(aI):this.hideLoadingMessage();if(aR.exception){var aP=LABKEY.ActionURL.buildURL("query","viewQuerySource.view",this.containerPath,{schemaName:this.schemaName,"query.queryName":this.queryName});var aQ=LABKEY.Utils.encodeHtml(aR.exception)+" &nbsp;<a target=_blank class='labkey-button' href='"+aP+"'>View Source</a>";this.showErrorMessage(aQ);return}this.customizeView=Ext4.create("LABKEY.internal.ViewDesigner.Designer",{renderTo:Ext4.getBody().createChild({tag:"div",customizeView:true,style:{display:"none"}}),activeTab:aJ,dataRegion:this,containerPath:this.containerPath,schemaName:this.schemaName,queryName:this.queryName,viewName:aW,query:aR,userFilter:aU,userSort:aO,userColumns:aV,userContainerFilter:this.getUserContainerFilter(),allowableContainerFilters:this.allowableContainerFilters});this.customizeView.on("viewsave",function(a0,aZ,aY){ay.apply(this,[this,a0,aZ,aY])},this);this.customizeView.on({beforedeleteview:function(aZ,aY){aw(aL,aY)},deleteview:function(aY,a0,aZ){ah(aL,a0,aZ)}});var aS=true;var aX=function(a2,aY,aZ,a1,a0){if(aS){aY.hide();aY.getEl().appendTo(Ext4.get(aZ[0]));aS=false}aY.doLayout();am(aY.getEl().dom).slideDown(undefined,function(){aY.show();a1.call(a0)})};var aT=function(a2,aY,aZ,a1,a0){am(aY.getEl().dom).slideUp(undefined,function(){aY.hide();a1.call(a0)})};this.publishPanel(l,this.customizeView,aX,aT,this);this.showPanel(l)};var aM=function(){aI>0?clearTimeout(aI):this.hideLoadingMessage()};this.getQueryDetails(aN,aM,this)},aL)}else{if(aJ){aK.panel.setActiveDesignerTab(aJ)}this.showPanel(l)}};LABKEY.DataRegion.prototype.toggleShowCustomizeView=function(){if(this.activePanelId===l){this.hideCustomizeView()}else{this.showCustomizeView(undefined)}};var e=function(aK,aJ,aM,aI,aL){am("#"+aK).slideDown(undefined,function(){aI.call(aL)})};var aa=function(aK,aJ,aM,aI,aL){am("#"+aK).slideUp(undefined,function(){aI.call(aL)})};LABKEY.DataRegion.prototype.publishPanel=function(aJ,aI,aL,aM,aK){this.panelConfigurations[aJ]={panel:aI,show:am.isFunction(aL)?aL:e,hide:am.isFunction(aM)?aM:aa,scope:aK};return this};LABKEY.DataRegion.prototype.getPanelConfiguration=function(aI){return this.panelConfigurations[aI]};LABKEY.DataRegion.prototype.hidePanel=function(aL,aJ){if(this.activePanelId){var aI=this.getPanelConfiguration(this.activePanelId);if(aI){var aK=ap(this);aI.hide.call(aI.scope||this,this.activePanelId,aI.panel,aK,function(){this.activePanelId=undefined;aK.hide();if(am.isFunction(aL)){aL.call(aJ||this)}LABKEY.Utils.signalWebDriverTest("dataRegionPanelHide");am(this).trigger(am.Event("afterpanelhide"),[this])},this)}}else{if(am.isFunction(aL)){aL.call(aJ||this)}}};LABKEY.DataRegion.prototype.showPanel=function(aJ,aL,aK){var aI=this.getPanelConfiguration(aJ);if(!aI){console.error("Unable to find panel for id ("+aJ+"). Use publishPanel() to register a panel to be shown.");return}this.hideContext();this.hideMessage(true);this.hidePanel(function(){this.activePanelId=aJ;var aM=ap(this);aM.show();aI.show.call(aI.scope||this,this.activePanelId,aI.panel,aM,function(){if(am.isFunction(aL)){aL.call(aK||this)}LABKEY.Utils.signalWebDriverTest("dataRegionPanelShow");am(this).trigger(am.Event("afterpanelshow"),[this])},this)},this)};var al=function(){if(this._allowHeaderLock===true){this.hLock=new a(this)}};var k=function(){var aJ=P[this.name];if(aJ){var aI=this;am.each(aJ,function(aL,aK){aK.cb.call(aK.scope||aI,aI)});delete P[this.name]}};var i="/Cohort/Label";var h="/InitialCohort/Label";var H="/Cohort/Enrolled";var ar="/InitialCohort/Enrolled";LABKEY.DataRegion.prototype._removeCohortGroupFilters=function(aI,aJ){var aP=m(this);var aL=[],aM,aO,aK;var aN=[aI+i,aI+h,aI+H,aI+ar];if(am.isArray(aJ)){for(aK=0;aK<aJ.length;aK++){aN.push(aI+"/"+aJ[aK])}}for(aM=0;aM<aP.length;aM++){aO=aP[aM][0];if(aO.indexOf(this.name+".")==0){for(aK=0;aK<aN.length;aK++){if(aO.indexOf(aN[aK]+"~")>-1){aL.push(aO);aK=aN.length}}}}w(this,undefined,aL)};LABKEY.DataRegion.prototype._replaceAdvCohortFilter=function(aK){var aM=m(this);var aI=[],aJ,aL;for(aJ=0;aJ<aM.length;aJ++){aL=aM[aJ][0];if(aL.indexOf(this.name+".")==0){if(aL.indexOf(i)>-1||aL.indexOf(h)>-1||aL.indexOf(H)>-1||aL.indexOf(ar)){aI.push(aL)}}}w(this,aK,aI)};LABKEY.DataRegion.prototype.getColumn=function(aJ){var aK=null,aI=LABKEY.Utils.isString,aL=this.columns;if(aI(aJ)&&am.isArray(aL)){am.each(["fieldKey","name","caption"],function(aN,aM){am.each(aL,function(aP,aO){if(aI(aO[aM])&&aO[aM]==aJ){aK=aO;return false}});if(aK){return false}})}return aK};LABKEY.DataRegion.prototype.getQueryConfig=function(){var aI={dataRegionName:this.name,dataRegionSelectionKey:this.selectionKey,schemaName:this.schemaName,viewName:this.viewName,sort:this.getParameter(this.name+Y),parameters:this.getParameters(false),containerFilter:this.containerFilter};if(this.queryName){aI.queryName=this.queryName}else{if(this.sql){aI.sql=this.sql}}var aJ=this.getUserFilterArray();if(aJ.length>0){aI.filters=aJ}return aI};LABKEY.DataRegion.prototype.hideButtonPanel=function(){this.hidePanel();this.showContext();this.showMessageArea()};LABKEY.DataRegion.prototype.render=function(aI){if(!this.RENDER_LOCK&&this.async){ac(this,aI);this.refresh()}};LABKEY.DataRegion.prototype.showButtonPanel=function(aK){var aL=ap(this),aJ=am(aK).attr("panel-toggle"),aI;if(aJ){aI=am("#"+aJ);if(aJ===this.activePanelId){this.hideButtonPanel()}else{if(aL.has(aI).length===0){aI.detach().appendTo(aL)}if(!this.getPanelConfiguration(aJ)){this.publishPanel(aJ)}this.showPanel(aJ)}}};LABKEY.DataRegion.prototype.loadFaceting=function(aI,aK){var aL=this;var aJ=function(){aL.facetLoaded=true;if(am.isFunction(aI)){aI.call(aK||this)}};LABKEY.requiresExt4ClientAPI(function(){if(LABKEY.devMode){LABKEY.requiresScript(["/study/ReportFilterPanel.js","/study/ParticipantFilterPanel.js"],function(){LABKEY.requiresScript("/dataregion/panel/Facet.js",aJ)})}else{LABKEY.requiresScript("/study/ParticipantFilter.min.js",function(){LABKEY.requiresScript("/dataregion/panel/Facet.js",aJ)})}},this)};LABKEY.DataRegion.prototype.showFaceting=function(){if(this.facetLoaded){if(!this.facet){this.facet=LABKEY.dataregion.panel.Facet.display(this)}this.facet.toggleCollapse()}else{this.loadFaceting(this.showFaceting,this)}};LABKEY.DataRegion.prototype.on=function(aI,aK,aJ){am(this).bind(aI,function(){aK.apply(aJ||this,am(arguments).slice(1))})};LABKEY.DataRegion.prototype._onButtonClick=function(aI){var aJ=this.findButtonById(this.buttonBar.items,aI);if(aJ&&am.isFunction(aJ.handler)){try{return aJ.handler.call(aJ.scope||this,this)}catch(aK){}}return false};LABKEY.DataRegion.prototype.findButtonById=function(aI,aL){if(!aI||!aI.length||aI.length<=0){return null}var aJ;for(var aK=0;aK<aI.length;aK++){if(aI[aK].id==aL){return aI[aK]}aJ=this.findButtonById(aI[aK].items,aL);if(null!=aJ){return aJ}}return null};LABKEY.DataRegion.prototype.headerLock=function(){return this._allowHeaderLock===true};LABKEY.DataRegion.prototype.disableHeaderLock=function(){if(this.headerLock()&&this.hLock){this.hLock.disable()}};LABKEY.DataRegion.prototype.toggleSummaryStatForCustomView=function(aK,aI,aJ){this.getQueryDetails(function(aM){var aL=R(aM,aK);if(aL&&C(aM,aI)){var aN=[];am.each(aL.analyticsProviders,function(aO,aP){if(aP.fieldKey===aI){aN.push(aP.name)}});if(aN.indexOf(aJ)===-1){aB.call(this,aL,aI,aJ,true)}else{v.call(this,aL,aI,aJ,true)}}},null,this)};LABKEY.DataRegion.prototype.getColumnAnalyticsProviders=function(aK,aJ,aL,aI){this.getQueryDetails(function(aN){var aM=R(aN,aK);if(aM&&C(aN,aJ)){var aO=[];am.each(aM.analyticsProviders,function(aP,aQ){if(aQ.fieldKey===aJ){aO.push(aQ.name)}});if(am.isFunction(aL)){aL.call(aI,aO)}}},null,this)};LABKEY.DataRegion.prototype.setColumnSummaryStatistics=function(aK,aJ,aI){this.getQueryDetails(function(aM){var aL=R(aM,aK);if(aL&&C(aM,aJ)){var aN=[];am.each(aL.analyticsProviders,function(aO,aP){if(aP.fieldKey!==aJ||aP.name.indexOf("AGG_")!=0){aN.push(aP)}});am.each(aI,function(aO,aP){aN.push({fieldKey:aJ,name:aP,isSummaryStatistic:true})});aL.analyticsProviders=aN;X.call(this,aL,true)}},null,this)};LABKEY.DataRegion.prototype.removeColumn=function(aJ,aI){this.getQueryDetails(function(aL){var aK=R(aL,aJ);if(aK&&C(aL,aI)){var aN=am.map(aK.columns,function(aO){return aO.fieldKey}),aM=aN.indexOf(aI);if(aM>-1){aK.columns.splice(aM,1);X.call(this,aK,true)}}},null,this)};LABKEY.DataRegion.prototype.addAnalyticsProviderForCustomView=function(aK,aJ,aI){this.getQueryDetails(function(aN){var aL=R(aN,aK);if(aL&&C(aN,aJ)){aB.call(this,aL,aJ,aI,false);var aM=this.name+":"+aJ+":analytics-"+aI;Ext4.each(Ext4.ComponentQuery.query("menuitem[elementId="+aM+"]"),function(aO){aO.disable()})}},null,this)};LABKEY.DataRegion.prototype.removeAnalyticsProviderForCustomView=function(aK,aJ,aI){this.getQueryDetails(function(aN){var aL=R(aN,aK);if(aL&&C(aN,aJ)){v.call(this,aL,aJ,aI,false);var aM=this.name+":"+aJ+":analytics-"+aI;Ext4.each(Ext4.ComponentQuery.query("menuitem[elementId="+aM+"]"),function(aO){aO.enable()})}},null,this)};LABKEY.DataRegion.prototype._openFilter=function(aK,aJ){if(aJ&&am(aJ.target).hasClass("fa-close")){return}var aL=this.getColumn(aK);if(aL){var aI=function(){this._dialogLoaded=true;new LABKEY.FilterDialog({dataRegionName:this.name,column:this.getColumn(aK),cacheFacetResults:false}).show()}.bind(this);this._dialogLoaded?aI():LABKEY.requiresExt3ClientAPI(aI)}else{LABKEY.Utils.alert("Column not available",'Unable to find column "'+aK+'" in this view.')}};var X=function(aJ,aK){var aI=am.extend({},aJ,{shared:false,inherit:false,session:true});LABKEY.Query.saveQueryViews({containerPath:this.containerPath,schemaName:this.schemaName,queryName:this.queryName,views:[aI],scope:this,success:function(aL){if(aK){this.refresh()}else{if(aL.views.length===1){this.view=aL.views[0];U.call(this);this.showContext()}}}})};var aB=function(aI,aL,aK,aJ){var aM=[];am.each(aI.analyticsProviders,function(aN,aO){if(aO.fieldKey===aL){aM.push(aO.name)}});if(aM.indexOf(aK)===-1){aI.analyticsProviders.push({fieldKey:aL,name:aK,isSummaryStatistic:aJ});X.call(this,aI,aJ)}};var v=function(aI,aM,aL,aK){var aJ=null;am.each(aI.analyticsProviders,function(aN,aO){if(aO.fieldKey===aM&&aO.name===aL){aJ=aN;return false}});if(aJ!=null){aI.analyticsProviders.splice(aJ,1);X.call(this,aI,aK)}};var aH=function(aJ,aK,aI){am.each(aI,function(aL,aM){if(LABKEY.Utils.isObject(aM)){if(aJ[aM.name]!==undefined){if(aM.check&&!aM.check.call(aJ,aJ[aM.name])){return}if(aM.prefix){aK[aJ.name+"."+aM.name]=aJ[aM.name]}else{aK[aM.name]=aJ[aM.name]}}}else{if(aM&&aJ[aM]!==undefined){aK[aM]=aJ[aM]}}})};var W=function(aO,aN,aI,aM){aI=Q(aO,aI);var aJ=aI.toString(),aL=[];if(aN!=null){var aK=aN.split(",");am.each(aK,function(aQ,aP){if(aP.length>0&&(aP!=aJ)&&(aP!=r+aJ)&&(aP!=g+aJ)){aL.push(aP)}})}if(aM===r){aM=""}if(LABKEY.Utils.isString(aM)){aL=[aM+aJ].concat(aL)}return aL.join(",")};var ak=function(aM,aL){if(!am.isArray(aL)){return""}var aJ=[],aI,aK;am.each(aL,function(aN,aO){aI=aO[0];aK=aO.length>1?aO[1]:undefined;aJ.push(encodeURIComponent(aI));if(LABKEY.Utils.isDefined(aK)){if(LABKEY.Utils.isDate(aK)){aK=am.format.date(aK,"yyyy-MM-dd");if(LABKEY.Utils.endsWith(aK,"Z")){aK=aK.substring(0,aK.length-1)}}aJ.push("=");aJ.push(encodeURIComponent(aK))}aJ.push("&")});if(aJ.length>0){aJ.pop()}return aJ.join("")};var ax=function(aJ,aI){var aK=LABKEY.Utils.getOnSuccess(aI);aI.success=function(aL){aJ.selectionModified=true;aJ.selectedCount=aL.count;ab(aJ);if(am.isFunction(aK)){aK.call(aI.scope,aL)}};return aI};var ac=function(aI,aJ){if(aJ){if(LABKEY.Utils.isString(aJ)){aI.renderTo=aJ}else{if(LABKEY.Utils.isString(aJ.id)){aI.renderTo=aJ.id}else{throw'Unsupported "renderTo"'}}}return aI};var au;var aw=function(aJ,aI){au=setTimeout(function(){au=0;aJ.showLoadingMessage(aI?"Reverting view...":"Deleting view...")},500)};var ah=function(aK,aL,aJ){if(au){clearTimeout(au)}if(aL){aK.removeMessage.call(aK,"customizeview");aK.showSuccessMessage.call(aK);var aI={type:"view"};if(aJ.viewName){aI.viewName=aJ.viewName}aK.changeView.call(aK,aI)}else{aK.removeMessage.call(aK,"customizeview");aK.showErrorMessage.call(aK,aJ.exception)}};var Z=function(aJ){aw(aJ,true);var aI={schemaName:aJ.schemaName,queryName:aJ.queryName,containerPath:aJ.containerPath,revert:true,success:function(aK){ah(aJ,true,aK)},failure:function(aK){ah(aJ,false,aK)}};if(aJ.viewName){aI.viewName=aJ.viewName}LABKEY.Query.deleteQueryView(aI)};var R=function(aJ,aK){var aI;am.each(aJ.views,function(aM,aL){if(aL.name===aK){aI=aL;return false}});return aI};var C=function(aI,aL){var aK=am.map(aI.columns,function(aM){return aM.fieldKey}),aJ=aK.indexOf(aL)>-1;if(!aJ){console.warn("Unable to find column in query: "+aL)}return aJ};var S=function(aI){return ag(aI).find('.labkey-selectors input[type="checkbox"][name=".toggle"]')};var F=function(aI){return am("#"+aI.domId+"-headerbar")};var aj=function(aI){return am("#"+aI.domId+"-ctxbar")};var ap=function(aI){return am("#"+aI.domId+"-drawer")};var ag=function(aJ){var aI=am("form#"+aJ.domId+"-form");if(aI.length===0){aI=am("#"+aJ.domId).closest("form")}return aI};var u=function(aI){return am("#"+aI.domId+"-header")};var V=function(aI){return ag(aI).find('.labkey-selectors input[type="checkbox"][name=".select"]')};var aA=function(aJ,aI){return am("#"+aJ.domId+"-section-"+aI)};var m=function(aN,aM){var aK=[];var aS=aN.requestURL;if(LABKEY.Utils.isString(aS)&&aS.length>0){var aL=aS.indexOf("?");if(aL>-1){aS=aS.substring(aL+1)}if(aS.length>1){var aJ=aS.split("&"),aI,aR,aO=".lastFilter",aP,aQ=am.isArray(aM);am.each(aJ,function(aU,aV){aI=aV.split("=",2);aR=aI[0]=decodeURIComponent(aI[0]);aP=aR.indexOf(aO);if(aP>-1&&aP==(aR.length-aO.length)){return}else{if(E.hasOwnProperty(aR)){return}}var aT=false;if(aQ){am.each(aM,function(aW,aX){if(LABKEY.Utils.isString(aX)){if(aX.indexOf(aC)==(aX.length-2)){if(aR.indexOf("~")>0){aT=true;return false}}else{if(aR.indexOf(aX)==0){if(aR==aX||aR.indexOf("~")>0||aR.indexOf(at)>0||aR==(aX+"sort")){aT=true;return false}}}}})}if(!aT){if(aI.length>1){aI[1]=decodeURIComponent(aI[1])}aK.push(aI)}})}}return aK};var o=function(aN,aL){var aM=[],aK=aN.getParameter(aN.name+Y);if(aL){aM=aK||""}else{if(aK){var aI,aJ;am.each(aK.split(","),function(aP,aO){aI=aO;aJ=r;if(aO.charAt(0)==g){aI=aI.substring(1);aJ=g}else{if(aO.charAt(0)==r){aI=aI.substring(1)}}aM.push({fieldKey:aI,dir:aJ})})}}return aM};var A=function(aI){return am("#"+aI.domId+"-viewbar")};var G=function(aL,aI,aK){var aJ=aL.msgbox.getParent().find('div[data-msgpart="selection"]');aJ.find(".labkey-button"+aI).off("click").on("click",am.proxy(function(){aK.call(this)},aL))};var N=function(aK,aJ){var aI=aK.msgbox;if(aI){if(aK.showRecordSelectors&&aJ.selection){G(aK,".select-all",aK.selectAll);G(aK,".select-none",aK.clearSelected);G(aK,".show-all",aK.showAll);G(aK,".show-selected",aK.showSelectedRows);G(aK,".show-unselected",aK.showUnselectedRows)}else{if(aJ.customizeview){G(aK,".unsavedview-revert",function(){Z(this)});G(aK,".unsavedview-edit",function(){this.showCustomizeView(undefined)});G(aK,".unsavedview-save",function(){t(this)})}}}};var ab=function(aI){am(aI).trigger("selectchange",[aI,aI.selectedCount]);B(aI,aI.selectedCount);LABKEY.Utils.signalWebDriverTest("dataRegionUpdate",aI.selectedCount);LABKEY.Utils.signalWebDriverTest("dataRegionUpdate-"+aI.name,aI.selectedCount)};var ay=function(aL,aK,aJ,aI){if(aJ&&aJ.views.length>0){aL.hideCustomizeView.call(aL);aL.changeView.call(aL,{type:"view",viewName:aJ.views[0].name},aI)}};var aq=function(aI,aJ){return c(aI,null,aJ)};var Q=function(aK,aI){var aJ=aI;if(!(aJ instanceof LABKEY.FieldKey)){aJ=LABKEY.FieldKey.fromString(""+aJ)}return aJ};var t=function(aI){if(!(aI.view&&aI.view.session)){return}var aJ=(aI.view&&aI.view.name)||aI.viewName||"";LABKEY.Query.getQueryDetails({schemaName:aI.schemaName,queryName:aI.queryName,viewName:aJ,initializeMissingView:false,containerPath:aI.containerPath,success:function(aL){if(aL.exception){var aK=LABKEY.ActionURL.buildURL("query","viewQuerySource.view",null,{schemaName:this.schemaName,"query.queryName":this.queryName});var aM=LABKEY.Utils.encodeHtml(aL.exception)+" &nbsp;<a target=_blank class='labkey-button' href='"+aK+"'>View Source</a>";this.showErrorMessage.call(this,aM);return}q(this,aL)},scope:aI})};var q=function(aK,aI){var aJ=Ext4.applyIf({allowableContainerFilters:aK.allowableContainerFilters,targetContainers:aI.targetContainers,canEditSharedViews:aI.canEditSharedViews,canEdit:LABKEY.DataRegion.getCustomViewEditableErrors(aJ).length==0,success:function(aN,aO){var aL=setTimeout(function(){aL=0;Ext4.Msg.progress("Saving...","Saving custom view...")},500);var aM={schemaName:aK.schemaName,"query.queryName":aK.queryName,"query.viewName":aK.viewName,newName:aO.name,inherit:aO.inherit,shared:aO.shared};if(aO.inherit){aM.containerPath=aO.containerPath}LABKEY.Ajax.request({url:LABKEY.ActionURL.buildURL("query","saveSessionView",aK.containerPath),method:"POST",jsonData:aM,callback:function(){if(aL>0){clearTimeout(aL)}aN.close()},success:function(){aK.showSuccessMessage.call(aK);aK.changeView.call(aK,{type:"view",viewName:aO.name})},failure:function(aP){Ext4.Msg.alert("Error saving view",aP.exception||aP.statusText)},scope:aK})},scope:aK},aK.view);LABKEY.DataRegion.loadViewDesigner(function(){LABKEY.internal.ViewDesigner.Designer.saveCustomizeViewPrompt(aJ)})};var d=function(aJ,aK,aI,aL){c(aJ,[[aK,aI]],aL)};var c=function(aK,aJ,aN){if(am.isArray(aN)){am.each(aN,function(aO,aP){if(aP&&aP.indexOf(aK.name+".")!==0){aN[aO]=aK.name+aP}})}var aM,aI,aL=m(aK,aN);if(am.isArray(aJ)){am.each(aJ,function(aO,aP){if(!am.isArray(aP)){throw new Error("DataRegion: _setParameters newParamValPairs improperly initialized. It is an array of arrays. You most likely passed in an array of strings.")}aM=aP[0];aI=aP[1];if(LABKEY.Utils.isString(aM)&&aM.length>1){if(aM.indexOf(aK.name)!==0){aM=aK.name+aM}aL.push([aM,aI])}})}if(aK.async){n(aK,undefined,undefined,aL)}else{aK.setSearchString.call(aK,aK.name,ak(aK,aL))}};var y=function(aJ,aI){this.maxRows=undefined;this.offset=0;d(aJ,ai,aI,[av,aD,ai])};var b=function(aJ,aK){if(aJ.showRecordSelectors){if(aJ.totalRows&&aJ.totalRows!=aJ.selectedCount){aK+="&nbsp;<span class='labkey-button select-all'>Select All "+aJ.totalRows+" Rows</span>"}aK+="&nbsp;<span class='labkey-button select-none'>Select None</span>";var aI=[];if(aJ.showRows!=="all"){aI.push("<span class='labkey-button show-all'>Show All</span>")}if(aJ.showRows!=="selected"){aI.push("<span class='labkey-button show-selected'>Show Selected</span>")}if(aJ.showRows!=="unselected"){aI.push("<span class='labkey-button show-unselected'>Show Unselected</span>")}aK+="&nbsp;&nbsp;"+aI.join(" ")}aJ.addMessage.call(aJ,aK,"selection")};var s=function(aK,aJ){var aI=[];V(aK).each(function(){if(!this.disabled){this.checked=aJ;aI.push(this.value)}});S(aK).each(function(){this.checked=aJ===true});return aI};var n=function(aP,aR,aS,aN){var aK=J(aP,aN?aN:m(aP));var aQ=O(aP,aK);if(aK.sql){delete aK.sql}var aO;var aM=true;var aI;if(aP.renderTo){aM=false;aI=aP.renderTo;aO=am("#"+aP.renderTo)}else{if(!aP.domId){throw'"renderTo" must be specified either upon construction or when calling render()'}else{aI=aP.domId;aO=am("#"+aP.domId);var aJ=ag(aP);if(aJ.length&&aJ.parent("div").length){aO=aJ.parent("div")}else{throw"unable to find a good target element. Perhaps this region is not using the standard renderer?"}}}var aL=setTimeout(function(){aL=0;if(aO){aO.html('<div class="labkey-data-region-loading-mask-panel"><div class="labkey-data-region-loading-mask-icon"><i class="fa fa-spinner fa-pulse"></i> loading...</div></div>')}},500);LABKEY.Ajax.request({timeout:aP.timeout===undefined?M:aP.timeout,url:LABKEY.ActionURL.buildURL("project","getWebPart.api",aP.containerPath),method:"POST",params:aK,jsonData:aQ,success:function(aT){if(aL>0){clearTimeout(aL)}this.hidePanel(function(){if(aO.length){this.destroy();LABKEY.Utils.loadAjaxContent(aT,aO,function(){if(am.isFunction(aR)){aR.call(aS)}if(am.isFunction(this._success)){this._success.call(this.scope||this,this,aT)}am(this).trigger("success",[this,aT]);this.RENDER_LOCK=true;am(this).trigger("render",this);this.RENDER_LOCK=false},this,aM)}else{if(am.isFunction(this._failure)){this._failure.call(this.scope||this,aT,aT,undefined,aO)}else{if(!this.suppressRenderErrors){LABKEY.Utils.alert("Rendering Error",'The element "'+aI+'" does not exist in the document. You may need to specify "renderTo".')}}}},this)},failure:LABKEY.Utils.getCallbackWrapper(function(aV,aT,aU){if(aO.length){if(am.isFunction(this._failure)){this._failure.call(this.scope||this,aV,aT,aU)}else{if(this.errorType==="html"){if(aM){aO.replaceWith('<div class="labkey-error">'+LABKEY.Utils.encodeHtml(aV.exception)+"</div>")}else{aO.html('<div class="labkey-error">'+LABKEY.Utils.encodeHtml(aV.exception)+"</div>")}}}}else{if(!this.suppressRenderErrors){LABKEY.Utils.alert("Rendering Error",'The element "'+aI+'" does not exist in the document. You may need to specify "renderTo".')}}},aP,true),scope:aP})};var O=function(aJ,aK){var aI={};if(aK.sql){aI.sql=aK.sql}az(aJ,aI);if(aJ.sort||aJ.filters||aJ.aggregates){aI.filters={};if(aJ.filters){LABKEY.Filter.appendFilterParams(aI.filters,aJ.filters,aJ.name)}if(aJ.sort){aI.filters[aJ.dataRegionName+Y]=aJ.sort}if(aJ.aggregates){LABKEY.Filter.appendAggregateParams(aI.filters,aJ.aggregates,aJ.name)}}if(aJ.metadata){aI.metadata=aJ.metadata}return aI};var az=function(aK,aI){var aJ=aK.buttonBar;if(aJ&&(aJ.position||(aJ.items&&aJ.items.length>0))){ao(aK,aJ.items);aI.buttonBar=aJ}};var ao=function(aL,aI){if(am.isArray(aI)&&aI.length>0){for(var aJ=0;aJ<aI.length;aJ++){var aK=aI[aJ];if(aK&&am.isFunction(aK.handler)){aK.id=aK.id||LABKEY.Utils.id();aK.onClick="return LABKEY.DataRegions['"+aL.name+"']._onButtonClick('"+aK.id+"');"}if(aK.items){ao(aL,aK.items)}}}};var D=function(aI,aJ){return aJ&&aJ.indexOf(aI.name+".")===0&&aJ.indexOf("~")>0};var J=function(aM,aO){var aN={};var aJ=aM.name;if(aM.async){aN[aJ+".async"]=true;if(LABKEY.Utils.isString(aM.frame)){aN["webpart.frame"]=aM.frame}if(LABKEY.Utils.isString(aM.bodyClass)){aN["webpart.bodyClass"]=aM.bodyClass}if(LABKEY.Utils.isString(aM.title)){aN["webpart.title"]=aM.title}if(LABKEY.Utils.isString(aM.titleHref)){aN["webpart.titleHref"]=aM.titleHref}if(LABKEY.Utils.isString(aM.columns)){aN[aM.name+".columns"]=aM.columns}aH(aM,aN,["allowChooseQuery","allowChooseView","allowHeaderLock","buttonBarPosition","detailsURL","deleteURL","importURL","insertURL","linkTarget","updateURL","shadeAlternatingRows","showBorders","showDeleteButton","showDetailsColumn","showExportButtons","showImportDataButton","showInsertNewButton","showPagination","showPaginationCount","showReports","showSurroundingBorder","showUpdateColumn","showViewPanel","timeout",{name:"disableAnalytics",prefix:true},{name:"maxRows",prefix:true,check:function(aP){return aP>0}},{name:"showRows",prefix:true},{name:"offset",prefix:true,check:function(aP){return aP!==0}},{name:"reportId",prefix:true},{name:"viewName",prefix:true}]);if(LABKEY.Utils.isString(aM._userSort)&&aM._userSort.length>0){aN[aJ+Y]=aM._userSort}if(aM.userFilters){am.each(aM.userFilters,function(aQ,aP){if(aN[aQ]==undefined){aN[aQ]=[]}aN[aQ].push(aP)});aM.userFilters={}}if(aM.userContainerFilter){aN[aJ+aE]=aM.userContainerFilter}if(aM.parameters){var aI=aJ+at;am.each(aM.parameters,function(aR,aQ){var aP=aR;if(aR.indexOf(aI)!==0){aP=aI+aR}aN[aP]=aQ})}}if(aO){am.each(aO,function(aP,aQ){if(D(aM,aQ[0])){if(aN[aQ[0]]==undefined){aN[aQ[0]]=[]}else{if(!am.isArray(aN[aQ[0]])){aN[aQ[0]]=[aN[aQ[0]]]}}aN[aQ[0]].push(aQ[1])}else{aN[aQ[0]]=aQ[1]}})}aN.dataRegionName=aM.name;aN.schemaName=aM.schemaName;aN.viewName=aM.viewName;aN.reportId=aM.reportId;aN.returnURL=window.location.href;aN["webpart.name"]="Query";if(aM.queryName){aN.queryName=aM.queryName}else{if(aM.sql){aN.sql=aM.sql}}var aK=aM.name+aE;var aL=aM.getContainerFilter.call(aM);if(aL&&!(aK in aN)){aN[aK]=aL}return aN};var w=function(aJ,aI,aL){var aK=[];if(aI){aK.push([aI.getURLParameterName(aJ.name),aI.getURLParameterValue()])}c(aJ,aK,[av].concat(aL))};var B=function(aK,aI){S(aK).each(function(){if(aK.isPageSelected.call(aK)){this.checked=true;this.indeterminate=false}else{if(aK.selectedCount>0){this.checked=false;this.indeterminate=true}else{this.checked=false;this.indeterminate=false}}});if(aK.totalRows&&aK.selectedCount==aK.totalRows&&!aK.complete){b(aK,'All <span class="labkey-strong">'+aK.totalRows+"</span> rows selected.")}if(!aK._requiresSelectionButtons){var aJ=aK.name.replace(/('|"|\\)/g,"\\$1");aK._requiresSelectionButtons=am("a[labkey-requires-selection='"+aJ+"']")}aK._requiresSelectionButtons.each(function(){var aL=am(this);var aM=aL.attr("labkey-requires-selection-min-count");if(aM){aM=parseInt(aM)}if(aM===undefined){aM=1}var aN=aL.attr("labkey-requires-selection-max-count");if(aN){aN=parseInt(aN)}if(aM<=aI&&(!aN||aN>=aI)){aL.removeClass("labkey-disabled-button")}else{aL.addClass("labkey-disabled-button")}})};var a=function(aL){if(!aL.headerLock()){aL._allowHeaderLock=false;return}this.region=aL;var aU=am("#"+aL.domId);var aI=aU.find("tr.labkey-alternate-row").first().children("td");if(aI.length===0){aI=aU.find("tr.labkey-row").first().children("td");if(aI.length===0){aL._allowHeaderLock=false;return}}var aJ=aL.domId+"-column-header-row";var aV=am("#"+aJ);if(aV.length===0){aL._allowHeaderLock=false;return}var aN=100;var aY=this,aQ,aX=false,aT=0,aO=[0,0,0,0];var aW=aV.clone().attr("id",aJ+"-float").css({"box-shadow":"0 4px 4px #DCDCDC",display:"none",position:"fixed",top:0});aW.insertAfter(aV);var aK=function(){aY.region._allowHeaderLock=false;if(aQ){clearTimeout(aQ)}am(window).unbind("load",aZ).unbind("resize",aS).unbind("scroll",aP);am(document).unbind("DOMNodeInserted",aZ)};var aR=function(){var a2=aV.offset()||{top:0};var a1=am("#"+aL.domId);var a0=a2.top+a1.height()-aN;aO=[a2.left,a2.top,a0]};aR();var aM=function(){aR();var a0=aV.find("th");aW.width(aV.width()).find("th").each(function(a1,a2){am(a2).width(am(a0[a1]).width())})};var aP=function(){if(window.pageYOffset>=aO[1]&&window.pageYOffset<aO[2]){var a0=aO[0]-window.pageXOffset;if(!aX){aX=true;aW.css({display:"table-row",left:a0})}else{if(aT!==a0){aW.css("left",a0)}}aW.css({top:0});aT=a0}else{if(aX&&window.pageYOffset>=aO[2]){aW.css({top:aO[2]-window.pageYOffset})}else{if(aX){aX=false;aW.hide()}}}};var aS=function(){clearTimeout(aQ);aQ=setTimeout(aM,110)};var aZ=function(){aS();aP()};am(window).one("load",aZ).on("resize",aS).on("scroll",aP);am(document).on("DOMNodeInserted",aZ);return{disable:aK}};LABKEY.DataRegion.create=function(aI){var aJ=LABKEY.DataRegions[aI.name];if(aJ){am.each(aI,function(aK,aL){aJ[aK]=aL});if(!aI.view){aJ.view=undefined}ae.call(aJ,aI)}else{aJ=new LABKEY.DataRegion(aI);LABKEY.DataRegions[aJ.name]=aJ}return aJ};LABKEY.DataRegion.loadViewDesigner=function(aI,aJ){LABKEY.requiresExt4Sandbox(function(){LABKEY.requiresScript("internal/ViewDesigner",aI,aJ)})};LABKEY.DataRegion.getCustomViewEditableErrors=function(aI){var aJ=[];if(aI&&!aI.editable){aJ.push("The view is read-only and cannot be edited.")}return aJ};LABKEY.DataRegion.registerPane=function(aK,aL,aI){var aJ=LABKEY.DataRegions[aK];if(aJ){aL.call(aI||aJ,aJ);return}else{if(!P[aK]){P[aK]=[]}}P[aK].push({cb:aL,scope:aI})};LABKEY.DataRegion.selectAll=function(aI){var aJ={};if(!aI.url){aI.url=LABKEY.ActionURL.buildURL("query","selectAll.api",aI.containerPath);aI.dataRegionName=aI.dataRegionName||"query";aJ=LABKEY.Query.buildQueryParams(aI.schemaName,aI.queryName,aI.filters,null,aI.dataRegionName);if(aI.viewName){aJ[aI.dataRegionName+p]=aI.viewName}if(aI.containerFilter){aJ.containerFilter=aI.containerFilter}if(aI.selectionKey){aJ[aI.dataRegionName+".selectionKey"]=aI.selectionKey}am.each(aI.parameters,function(aL,aK){aJ[aI.dataRegionName+at+aL]=aK});if(aI.ignoreFilter){aJ[aI.dataRegionName+".ignoreFilter"]=true}}LABKEY.Ajax.request({url:aI.url,method:"POST",params:aJ,success:LABKEY.Utils.getCallbackWrapper(LABKEY.Utils.getOnSuccess(aI),aI.scope),failure:LABKEY.Utils.getCallbackWrapper(LABKEY.Utils.getOnFailure(aI),aI.scope,true)})};LABKEY.DataRegion.setSelected=function(aJ){var aI=LABKEY.ActionURL.buildURL("query","setSelected.api",aJ.containerPath,{key:aJ.selectionKey,checked:aJ.checked});LABKEY.Ajax.request({url:aI,method:"POST",params:{id:aJ.ids||aJ.id},scope:aJ.scope,success:LABKEY.Utils.getCallbackWrapper(LABKEY.Utils.getOnSuccess(aJ),aJ.scope),failure:LABKEY.Utils.getCallbackWrapper(LABKEY.Utils.getOnFailure(aJ),aJ.scope,true)})};LABKEY.DataRegion.clearSelected=function(aJ){var aI=LABKEY.ActionURL.buildURL("query","clearSelected.api",aJ.containerPath,{key:aJ.selectionKey});LABKEY.Ajax.request({url:aI})};LABKEY.DataRegion.getSelected=function(aJ){var aI=LABKEY.ActionURL.buildURL("query","getSelected.api",aJ.containerPath,{key:aJ.selectionKey});LABKEY.Ajax.request({url:aI,success:LABKEY.Utils.getCallbackWrapper(LABKEY.Utils.getOnSuccess(aJ),aJ.scope),failure:LABKEY.Utils.getCallbackWrapper(LABKEY.Utils.getOnFailure(aJ),aJ.scope,true)})};var z=function(aJ,aI){this.bindRegion(aJ);if(aI){this.setMessages(aI)}};var K=z.prototype;K.bindRegion=function(aI){this.parentSel="#"+aI.domId+"-msgbox"};K.toJSON=function(){return this.parts};K.addMessage=function(aL,aJ,aI){aJ=aJ||"info";var aK=aJ.toLowerCase();if(aI&&this.parts.hasOwnProperty(aK)){this.parts[aK]+=aL;this.render(aK,aL)}else{this.parts[aK]=aL;this.render(aK)}};K.getMessage=function(aI){return this.parts[aI.toLowerCase()]};K.hasMessage=function(aI){return this.getMessage(aI)!==undefined};K.hasContent=function(){return this.parts&&Object.keys(this.parts).length>0};K.removeAll=function(){this.parts={};this.render()};K.removeMessage=function(aI){var aJ=aI.toLowerCase();if(this.parts.hasOwnProperty(aJ)){this.parts[aJ]=undefined;this.render()}};K.setMessages=function(aI){if(LABKEY.Utils.isObject(aI)){this.parts=aI}else{this.parts={}}};K.getParent=function(){return am(this.parentSel)};K.render=function(aM,aI){var aL=false,aK=this,aJ=this.getParent();am.each(this.parts,function(aO,aP){if(aP){var aN=aJ.find('div[data-msgpart="'+aO+'"]');if(aN.length===0){aJ.append(['<div class="lk-region-bar" data-msgpart="'+aO+'">',aP,"</div>"].join(""))}else{if(aM!==undefined&&aM===aO){if(aI!==undefined){aN.append(aI)}else{aN.html(aP)}}}aL=true}else{aJ.find('div[data-msgpart="'+aO+'"]').remove();delete aK.parts[aO]}});if(aL){this.show();am(this).trigger("rendermsg",[this,this.parts])}else{this.hide();aJ.html("")}};K.show=function(){this.getParent().show()};K.hide=function(){this.getParent().hide()};K.isVisible=function(){return am(this.parentSel+":visible").length>0};K.find=function(aI){return this.getParent().find(".dataregion_msgbox_ct").find(aI)};K.on=function(aI,aK,aJ){am(this).bind(aI,am.proxy(aK,aJ))};LABKEY.QueryWebPart=function(aI){aI._useQWPDefaults=true;return LABKEY.DataRegion.create(aI)}})(jQuery);LABKEY.QueryWebPart.standardButtons={query:"query",views:"grid views",insertNew:"insert new",deleteRows:"delete",exportRows:"export",print:"print",pageSize:"paging"};LABKEY.QueryWebPart.prototype.render=LABKEY.DataRegion.prototype.render;LABKEY.QueryWebPart.prototype.getDataRegion=LABKEY.DataRegion.prototype.getDataRegion;LABKEY.AggregateTypes={SUM:"sum",MEAN:"mean",COUNT:"count",MIN:"min",MAX:"max",AVG:"mean"};